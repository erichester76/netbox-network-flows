{% extends 'generic/object.html' %}
{% load static %}

{% block content %}
<div class="card">
    <h5 class="card-header">Traffic Flows for {{ object.name }}</h5>
    <div class="card-body">
        {% if flows %}
            <!-- Table View -->
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Source IP:Port</th>
                        <th>Destination IP:Port</th>
                        <th>Protocol</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    {% for flow in flows %}
                        <tr>
                            <td>{{ flow.src_ip }}:{{ flow.src_port }}</td>
                            <td>{{ flow.dst_ip }}:{{ flow.dst_port }}</td>
                            <td>{{ flow.protocol }}</td>
                            <td>{{ flow.timestamp|date:"Y-m-d H:i:s" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Mermaid Graphical View -->
            <div class="mt-4">
                <h6>Flow Diagram</h6>
                <div class="mermaid">
                    {{ mermaid_code|safe }}
                </div>
            </div>
        {% else %}
            <p>No traffic flows recorded for this virtual machine.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
    mermaid.initialize({ startOnLoad: true });
</script>
{% endblock %}